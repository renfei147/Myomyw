# Myomyw 通信协议 v3

## 概述

本通信协议基于Unix Socket，使用二进制格式进行数据传输

### 数据包格式

| 字节       | 描述                                  | 类型       |
| ---------- | ------------------------------------ | --------- |
| 0-3        | 数据包头，含有'NWRC'(ASCII),用于错误检查 | Byte\[4\] |
| 4-7        | 协议编号                              | Int32BE   |
| *          | 数组字段（可选）                        | Any       |

### 编号分配

1、编号查询协议固定使用编号0

2、其余协议编号按照服务器实例启动后协议于该实例的注册顺序由服务端分配

3、于某服务器实例注册的协议编号在该实例关闭后即刻失效

4、在任意服务器实例中编号与协议一一对应，

5、在任意服务器实例中协议不可重复注册，否则行为未定义

6、在任意服务器实例中协议一旦注册在该实例关闭前不可解除注册，否则行为为定义

7、客户端需要使用编号查询协议向其所连接的服务器实例获取协议编号

### 数据序列化

除单字节类型，注明端序的多字节整数，以及有特殊说明外，其余类型均使用MsgPack序列化

## 协议

### 编号查询协议【固定编号0】

#### 协议名称

\<Internal\>.Core.Network.Protocol.Hub.InfoFetch

#### 客户端发送

| 字节  | 描述     | 类型      |
| ----- | ------- | --------- |
| *     | 协议名称 | String    |

#### 服务端发送

| 字节  | 描述     | 类型      |
| ----- | ------- | --------- |
| *     | ID      | Int32     |

### 游戏操作通知协议（ServerNotificationProtocol）

#### 协议名称

Core.Game.ServerNotification

#### 服务端发送【无回执】

| 字节  | 描述     | 类型      |
| ----- | ------- | --------- |
| 0     | 通知序号 | Byte      |
| 1     | 操作数  | Byte      |

#### 通知序号含义

| 编号  | 描述            | 操作数   |
| ----- | -------------- | ------- |
| 0     | 游戏开始        |         |
| 1     | 本方本轮计时开始 |         |
| 2     | 本方本轮计时结束 |         |
| 3     | 对方本轮计时开始 |         |
| 4     | 对方本轮计时结束 |         |
| 5     | 游戏结束        | 是否胜利 |

### 服务端远程操作协议（ServerMasterProtocol）

#### 协议名称

Core.Game.ServerMaster

#### 服务端发送【无回执】

| 字节  | 描述     | 类型      |
| ----- | ------- | --------- |
| 0     | 操作序号 | Byte      |
| 1     | 操作数  | Byte      |

#### 操作序号含义

| 编号  | 描述     | 操作数    |
| ----- | --------| -------- |
| 0     | 开始送球 | 选定发射台 |
| 1     | 进行送球 |          |
| 2     | 结束本轮 |          |
| 3     | 本方投降 |          |

### 客户端远程操作协议（ServerSlaveProtocol）

#### 协议名称

Core.Game.ServerSlave

#### 客户端发送

| 字节  | 描述     | 类型      |
| ----- | ------- | --------- |
| 0-1   | 玩家序号 | Int16LE   |
| 2     | 操作序号 | Byte      |
| 3     | 操作数  | Byte      |

#### 操作序号含义

| 编号  | 描述     | 操作数    |
| ----- | --------| -------- |
| 0     | 开始送球 | 选定发射台 |
| 1     | 进行送球 |          |
| 2     | 结束本轮 |          |
| 3     | 本方投降 |          |

#### 服务端发送

| 字节  | 描述     | 类型      |
| ----- | ------- | --------- |
| 0-1   | 状态     | Byte(Bool)|
